# à¸à¸²à¸£à¸—à¸”à¸ªà¸­à¸šà¸£à¸±à¸™ Docker Compose

## à¸‚à¸±à¹‰à¸™à¸•à¸­à¸™à¸à¸²à¸£à¸£à¸±à¸™

1. **à¹€à¸›à¸´à¸” Terminal** à¹à¸¥à¸°à¸™à¸³à¸—à¸²à¸‡à¹„à¸›à¸¢à¸±à¸‡à¹‚à¸Ÿà¸¥à¹€à¸”à¸­à¸£à¹Œà¸—à¸µà¹ˆà¸¡à¸µà¹„à¸Ÿà¸¥à¹Œ docker-compose.yml:

   ```bash
   cd /Users/nevelopdevper/iDev/ABC
   ```

2. **à¸£à¸±à¸™à¸£à¸°à¸šà¸šà¸—à¸±à¹‰à¸‡à¸«à¸¡à¸”**:

   ```bash
   docker compose up
   ```

   à¸«à¸£à¸·à¸­à¸£à¸±à¸™à¹ƒà¸™à¹‚à¸«à¸¡à¸” detached (à¸—à¸³à¸‡à¸²à¸™à¹€à¸šà¸·à¹‰à¸­à¸‡à¸«à¸¥à¸±à¸‡):

   ```bash
   docker compose up -d
   ```

3. **à¸£à¸­à¹ƒà¸«à¹‰à¸£à¸°à¸šà¸šà¹€à¸£à¸´à¹ˆà¸¡à¸—à¸³à¸‡à¸²à¸™** (à¸­à¸²à¸ˆà¹ƒà¸Šà¹‰à¹€à¸§à¸¥à¸²à¸ªà¸±à¸à¸„à¸£à¸¹à¹ˆà¹ƒà¸™à¸à¸²à¸£ build images à¸„à¸£à¸±à¹‰à¸‡à¹à¸£à¸)

## à¸à¸²à¸£à¸—à¸”à¸ªà¸­à¸šà¸£à¸°à¸šà¸š

1. **à¸—à¸”à¸ªà¸­à¸š Backend API**:
   - à¹€à¸›à¸´à¸”à¹€à¸šà¸£à¸²à¸§à¹Œà¹€à¸‹à¸­à¸£à¹Œà¹„à¸›à¸—à¸µà¹ˆ: http://localhost:5000/swagger
   - à¸«à¸£à¸·à¸­à¸—à¸”à¸ªà¸­à¸šà¸”à¹‰à¸§à¸¢ curl: `curl http://localhost:5000/weatherforecast`

2. **à¸—à¸”à¸ªà¸­à¸š Frontend**:
   - à¹€à¸›à¸´à¸”à¹€à¸šà¸£à¸²à¸§à¹Œà¹€à¸‹à¸­à¸£à¹Œà¹„à¸›à¸—à¸µà¹ˆ: http://localhost:3000

3. **à¸•à¸£à¸§à¸ˆà¸ªà¸­à¸šà¸à¸²à¸™à¸‚à¹‰à¸­à¸¡à¸¹à¸¥**:
   - à¹€à¸Šà¸·à¹ˆà¸­à¸¡à¸•à¹ˆà¸­ SQL Server à¸”à¹‰à¸§à¸¢à¹‚à¸›à¸£à¹à¸à¸£à¸¡à¸ˆà¸±à¸”à¸à¸²à¸£à¸à¸²à¸™à¸‚à¹‰à¸­à¸¡à¸¹à¸¥ (à¹€à¸Šà¹ˆà¸™ Azure Data Studio)
   - Host: localhost
   - Port: 1433
   - User: sa
   - Password: YourStrongPassword!
   - Database: ABC

## à¸à¸²à¸£à¸”à¸¹à¸šà¸±à¸™à¸—à¸¶à¸ (Logs)

```bash
# à¸”à¸¹à¸šà¸±à¸™à¸—à¸¶à¸à¸—à¸±à¹‰à¸‡à¸«à¸¡à¸”
docker-compose logs

# à¸”à¸¹à¸šà¸±à¸™à¸—à¸¶à¸à¹€à¸‰à¸à¸²à¸° service
docker-compose logs backend
docker-compose logs frontend
docker-compose logs db

# à¸”à¸¹à¸šà¸±à¸™à¸—à¸¶à¸à¹à¸šà¸š real-time
docker-compose logs -f
```

## à¸à¸²à¸£à¸ˆà¸±à¸”à¸à¸²à¸£à¸„à¸­à¸™à¹€à¸—à¸™à¹€à¸™à¸­à¸£à¹Œ

```bash
# à¸«à¸¢à¸¸à¸”à¸à¸²à¸£à¸—à¸³à¸‡à¸²à¸™
docker-compose down

# à¸«à¸¢à¸¸à¸”à¹à¸¥à¸°à¸¥à¸š volumes (à¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¹ƒà¸™à¸à¸²à¸™à¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¸ˆà¸°à¸«à¸²à¸¢à¹„à¸›)
docker-compose down -v

# à¸ªà¸£à¹‰à¸²à¸‡ build à¹ƒà¸«à¸¡à¹ˆ
docker-compose build

# à¸£à¸µà¸ªà¸•à¸²à¸£à¹Œà¸—à¹€à¸‰à¸à¸²à¸°à¸šà¸£à¸´à¸à¸²à¸£
docker-compose restart backend
```

## à¸à¸²à¸£à¹à¸à¹‰à¹„à¸‚à¸›à¸±à¸à¸«à¸²à¹€à¸šà¸·à¹‰à¸­à¸‡à¸•à¹‰à¸™

- à¸«à¸²à¸à¸¡à¸µà¸›à¸±à¸à¸«à¸²à¸à¸²à¸£à¹€à¸Šà¸·à¹ˆà¸­à¸¡à¸•à¹ˆà¸­à¸£à¸°à¸«à¸§à¹ˆà¸²à¸‡ services à¹ƒà¸«à¹‰à¸•à¸£à¸§à¸ˆà¸ªà¸­à¸š network settings
- à¸«à¸²à¸à¸à¸²à¸™à¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¹€à¸Šà¸·à¹ˆà¸­à¸¡à¸•à¹ˆà¸­à¹„à¸¡à¹ˆà¹„à¸”à¹‰ à¸¥à¸­à¸‡ wait-for-it script à¸«à¸£à¸·à¸­à¹ƒà¸Šà¹‰ depends_on condition
- à¸–à¹‰à¸² frontend à¹„à¸¡à¹ˆà¸ªà¸²à¸¡à¸²à¸£à¸–à¹€à¸Šà¸·à¹ˆà¸­à¸¡à¸•à¹ˆà¸­ API à¹„à¸”à¹‰ à¸•à¸£à¸§à¸ˆà¸ªà¸­à¸šà¸„à¹ˆà¸² NEXT_PUBLIC_API_URL

à¸•à¹‰à¸­à¸‡à¸à¸²à¸£à¸„à¸³à¹à¸™à¸°à¸™à¸³à¹€à¸à¸´à¹ˆà¸¡à¹€à¸•à¸´à¸¡à¹ƒà¸™à¸ªà¹ˆà¸§à¸™à¹„à¸«à¸™à¹„à¸«à¸¡à¸„à¸£à¸±à¸š?

Project Structure à¹à¸™à¸°à¸™à¸³:
ABC/
â”œâ”€â”€ .env.development        # Local dev secrets
â”œâ”€â”€ .env.production        # Production secrets
â”œâ”€â”€ docker-compose.yml     # Production
â”œâ”€â”€ docker-compose.dev.yml # Development (à¸–à¹‰à¸²à¸ˆà¸³à¹€à¸›à¹‡à¸™)
â”œâ”€â”€ Backend/
â”‚   â””â”€â”€ src/API/
â”‚       â”œâ”€â”€ appsettings.Development.json
â”‚       â””â”€â”€ appsettings.Production.json
â””â”€â”€ scripts/
    â”œâ”€â”€ dev.sh            # dotnet watch run
    â”œâ”€â”€ build.sh          # docker build
    â””â”€â”€ deploy.sh         # docker compose up

Migration
# ABC Project

## Database Management

### Development Environment

#### Method 1: dotnet CLI (à¹à¸™à¸°à¸™à¸³)
```bash
cd Backend/src/API

# à¸ªà¸£à¹‰à¸²à¸‡ migration
dotnet ef migrations add MigrationName

# à¸­à¸±à¸à¹€à¸”à¸— database
dotnet ef database update
```

#### Method 2: Automatic Migration (à¸£à¸°à¸§à¸±à¸‡!)
```csharp
// Program.cs - à¹ƒà¸Šà¹‰à¹€à¸‰à¸à¸²à¸° Development à¹à¸¥à¸° Database à¹ƒà¸«à¸¡à¹ˆ
if (app.Environment.IsDevelopment())
{
    context.Database.Migrate(); // à¸­à¸²à¸ˆ error à¸–à¹‰à¸² table à¸¡à¸µà¸­à¸¢à¸¹à¹ˆà¹à¸¥à¹‰à¸§
}
```

### Production Environment

#### âš ï¸ à¸«à¹‰à¸²à¸¡à¹ƒà¸Šà¹‰ Automatic Migration
```bash
# à¸ªà¸£à¹‰à¸²à¸‡ SQL script
dotnet ef migrations script --output migration.sql

# Review script à¸à¹ˆà¸­à¸™
cat migration.sql

# à¸£à¸±à¸™ script à¹ƒà¸™ Production Database manually
psql -h your-host -U username -d database -f migration.sql
```

### à¹à¸à¹‰à¹„à¸‚à¸›à¸±à¸à¸«à¸² Table Already Exists

#### à¸§à¸´à¸˜à¸µà¸—à¸µà¹ˆ 1: Empty Migration
```bash
dotnet ef migrations add SyncExistingTables
# à¹à¸à¹‰à¹„à¸‚à¹„à¸Ÿà¸¥à¹Œà¹ƒà¸«à¹‰ Up() à¹à¸¥à¸° Down() à¸§à¹ˆà¸²à¸‡
dotnet ef database update
```

#### à¸§à¸´à¸˜à¸µà¸—à¸µà¹ˆ 2: Manual Sync
```sql
INSERT INTO "__EFMigrationsHistory" ("MigrationId", "ProductVersion")
VALUES ('20241225000000_InitialCreate', '8.0.0');
```

## Development Workflow

### à¸à¸²à¸£à¸à¸±à¸’à¸™à¸²à¸›à¸à¸•à¸´:
```bash
# Terminal 1: Backend Development
cd Backend/src/API
dotnet watch run

# Terminal 2: Database Operations
cd Backend/src/API
dotnet ef migrations add NewFeature
dotnet ef database update

# Terminal 3: Frontend Development
cd Frontend/abc-client
npm run dev
```

### à¸à¸²à¸£ Deploy:
```bash
# 1. à¸ªà¸£à¹‰à¸²à¸‡ Migration Script
dotnet ef migrations script --output migration.sql

# 2. Deploy Application
docker compose up -d

# 3. à¸£à¸±à¸™ Migration Script manually
# (à¸œà¹ˆà¸²à¸™ Supabase Dashboard à¸«à¸£à¸·à¸­ CLI)
```

## âš ï¸ à¸„à¸³à¹€à¸•à¸·à¸­à¸™

- **à¸«à¹‰à¸²à¸¡à¹ƒà¸Šà¹‰ automatic migration à¹ƒà¸™ Production**
- **à¸•à¸£à¸§à¸ˆà¸ªà¸­à¸š migration script à¸à¹ˆà¸­à¸™ deploy**
- **Backup database à¸à¹ˆà¸­à¸™ migration à¹€à¸ªà¸¡à¸­**
- **Test migration à¹ƒà¸™ staging environment à¸à¹ˆà¸­à¸™**


ğŸ’¡ Tips:
à¹à¸¢à¸ Frontend/Backend - deploy à¸„à¸™à¸¥à¸° platform
à¹ƒà¸Šà¹‰ Supabase - database à¹„à¸¡à¹ˆà¸•à¹‰à¸­à¸‡à¸à¸±à¸‡à¸§à¸¥
Setup CI/CD - auto-deploy à¹€à¸¡à¸·à¹ˆà¸­ push
Monitor Usage - à¸”à¸¹ billing à¸à¹ˆà¸­à¸™à¹€à¸à¸´à¸™ free tier
ğŸ¯ à¹à¸™à¸§à¸—à¸²à¸‡à¹à¸™à¸°à¸™à¸³:
Railway: Backend API
Vercel: Next.js Frontend
Supabase: Database (à¹ƒà¸Šà¹‰à¹€à¸”à¸´à¸¡à¸•à¹ˆà¸­à¹„à¸”à¹‰)

# à¸ªà¸£à¹‰à¸²à¸‡ migration à¹ƒà¸™ Infrastructure
dotnet ef migrations add InitialCreate \
  --project ../Infrastructure \
  --startup-project . \
  --context ApplicationDbContext \
  --output-dir Data/Migrations

# à¸£à¸±à¸™ migration
dotnet ef database update --project ../Infrastructure --startup-project . --context ApplicationDbContext

## ğŸ§ª **Test Strategy à¸—à¸µà¹ˆà¹€à¸£à¸²à¹ƒà¸Šà¹‰:**

### **ğŸ“Š Test Coverage à¸—à¸µà¹ˆà¸¡à¸µà¸­à¸¢à¸¹à¹ˆ:**

#### **ğŸ—ï¸ Test Structure (Test Pyramid):**
```
        /\
       /  \
      / E2E \ (5-10%)
     /______\
    /        \
   / Integration \ (20-30%)
  /______________\
 /                \
/   Unit Tests      \ (70-80%)
\___________________/
```

#### **ğŸ“ Test Organization:**
```
Tests/Application.Tests/Services/
â”œâ”€â”€ PortfolioServiceTests.cs              (17 Unit Tests - Mock-based)
â”œâ”€â”€ PortfolioServiceIntegrationTests.cs   (2 Integration Tests - In-memory DB)
â”œâ”€â”€ ProjectServiceTests.cs                (17 Unit Tests - Mock-based)
â””â”€â”€ ProjectServiceIntegrationTests.cs     (13 Integration Tests - In-memory DB)

ğŸ¯ Total: 49 Tests - All Passing! âœ…
```

### **ğŸ§ª Unit Tests (Mock-based) - à¹€à¸£à¹‡à¸§, Isolated**
**PortfolioServiceTests (17 tests):**
- âœ… Business logic validation
- âœ… Error handling & edge cases  
- âœ… Method call verification
- âœ… Title length validation
- âœ… User ownership logic

**ProjectServiceTests (17 tests):**
- âœ… CRUD operations logic
- âœ… Portfolio existence validation
- âœ… Project title validation
- âœ… User ownership verification
- âœ… DateTime handling logic

### **ğŸ”§ Integration Tests (In-memory DB) - Real scenarios**
**PortfolioServiceIntegrationTests (2 tests):**
- âœ… Database persistence validation
- âœ… EF Core navigation properties

**ProjectServiceIntegrationTests (13 tests):**
- âœ… Complete CRUD workflows
- âœ… Real database operations
- âœ… Entity relationships testing
- âœ… Data validation scenarios

### **âš¡ à¸à¸²à¸£à¸£à¸±à¸™ Tests:**
```bash
# Unit tests only (à¹€à¸£à¹‡à¸§ - à¸ªà¸³à¸«à¸£à¸±à¸š development)
dotnet test --filter "PortfolioServiceTests"
dotnet test --filter "ProjectServiceTests"

# Integration tests (à¸Šà¹‰à¸²à¸à¸§à¹ˆà¸² - à¸ªà¸³à¸«à¸£à¸±à¸š CI/CD)
dotnet test --filter "Integration"

# All tests
dotnet test
```

## ğŸ¯ **à¸„à¸§à¸²à¸¡à¹à¸•à¸à¸•à¹ˆà¸²à¸‡à¸£à¸°à¸«à¸§à¹ˆà¸²à¸‡ Unit Tests vs Integration Tests**

### **ğŸ§ª Unit Tests (Mock-based)**
```csharp
// à¸•à¸±à¸§à¸­à¸¢à¹ˆà¸²à¸‡: ProjectServiceTests.cs
[Fact]
public async Task CreateProjectAsync_WithValidProject_ReturnsCreatedProject()
{
    // Arrange - à¹ƒà¸Šà¹‰ Mock objects
    _mockPortfolioService.Setup(p => p.PortfolioExistsAsync(1)).ReturnsAsync(true);
    _mockGenericRepository.Setup(r => r.AddAsync(It.IsAny<Project>())).Returns(Task.CompletedTask);
    
    // Act - à¹€à¸£à¸µà¸¢à¸à¹ƒà¸Šà¹‰ service
    var result = await _projectService.CreateProjectAsync(project);
    
    // Assert - à¸•à¸£à¸§à¸ˆà¸ªà¸­à¸š method calls à¹à¸¥à¸° logic
    _mockPortfolioService.Verify(p => p.PortfolioExistsAsync(1), Times.Once);
    _mockGenericRepository.Verify(r => r.AddAsync(project), Times.Once);
}
```
**ğŸ¯ à¸ˆà¸¸à¸”à¸›à¸£à¸°à¸ªà¸‡à¸„à¹Œ:** à¸—à¸”à¸ªà¸­à¸š business logic à¹à¸¢à¸à¸ªà¹ˆà¸§à¸™  
**âš¡ à¸„à¸§à¸²à¸¡à¹€à¸£à¹‡à¸§:** à¹€à¸£à¹‡à¸§à¸¡à¸²à¸ (milliseconds)  
**ğŸ›¡ï¸ Isolation:** à¹à¸¢à¸à¸‚à¸²à¸”à¸ˆà¸²à¸ dependencies  
**ğŸ” à¸‚à¸­à¸šà¹€à¸‚à¸•:** Method/Class à¹€à¸”à¸µà¸¢à¸§

### **ğŸ”§ Integration Tests (In-memory Database)**
```csharp
// à¸•à¸±à¸§à¸­à¸¢à¹ˆà¸²à¸‡: ProjectServiceIntegrationTests.cs
[Fact]
public async Task CreateProjectAsync_WithValidData_CreatesProject()
{
    // Arrange - à¹ƒà¸Šà¹‰ real objects à¸à¸±à¸š in-memory database
    var newProject = new Project { Title = "Test Project", PortfolioId = 1 };
    
    // Act - à¹€à¸£à¸µà¸¢à¸à¹ƒà¸Šà¹‰ service à¸ˆà¸£à¸´à¸‡ à¹„à¸›à¸–à¸¶à¸‡ database
    var result = await _projectService.CreateProjectAsync(newProject);
    
    // Assert - à¸•à¸£à¸§à¸ˆà¸ªà¸­à¸šà¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¸—à¸µà¹ˆà¸šà¸±à¸™à¸—à¸¶à¸à¸ˆà¸£à¸´à¸‡à¹ƒà¸™ database
    var persistedProject = await _context.Projects.FindAsync(result.Id);
    persistedProject.Should().NotBeNull();
}
```
**ğŸ¯ à¸ˆà¸¸à¸”à¸›à¸£à¸°à¸ªà¸‡à¸„à¹Œ:** à¸—à¸”à¸ªà¸­à¸šà¸à¸²à¸£à¸—à¸³à¸‡à¸²à¸™à¸£à¹ˆà¸§à¸¡à¸à¸±à¸™à¸‚à¸­à¸‡à¸«à¸¥à¸²à¸¢ components  
**âš¡ à¸„à¸§à¸²à¸¡à¹€à¸£à¹‡à¸§:** à¸Šà¹‰à¸²à¸à¸§à¹ˆà¸² à¹à¸•à¹ˆà¸¢à¸±à¸‡à¹€à¸£à¹‡à¸§  
**ğŸŒ Database:** In-memory database  
**ğŸ” à¸‚à¸­à¸šà¹€à¸‚à¸•:** à¸«à¸¥à¸²à¸¢ layers à¸£à¹ˆà¸§à¸¡à¸à¸±à¸™

### **ğŸ“Š à¸ªà¸£à¸¸à¸›à¸à¸²à¸£à¹ƒà¸Šà¹‰à¸‡à¸²à¸™:**
| à¸ªà¸–à¸²à¸™à¸à¸²à¸£à¸“à¹Œ | à¹ƒà¸Šà¹‰ Unit Tests | à¹ƒà¸Šà¹‰ Integration Tests |
|-----------|---------------|---------------------|
| à¸—à¸”à¸ªà¸­à¸š Business Logic | âœ… | âŒ |
| à¸—à¸”à¸ªà¸­à¸š Database Operations | âŒ | âœ… |
| à¸—à¸”à¸ªà¸­à¸š Validation Rules | âœ… | âŒ |
| à¸—à¸”à¸ªà¸­à¸š Entity Relationships | âŒ | âœ… |
| Development Feedback | âœ… | âŒ |
| CI/CD Pipeline | âœ… | âœ… |

à¸ªà¸£à¸¸à¸›à¸„à¸·à¸­ **Unit Tests** à¹ƒà¸Šà¹‰à¸ªà¸³à¸«à¸£à¸±à¸šà¸—à¸”à¸ªà¸­à¸š logic à¸ªà¹ˆà¸§à¸™à¸•à¸±à¸§ à¸ªà¹ˆà¸§à¸™ **Integration Tests** à¹ƒà¸Šà¹‰à¸ªà¸³à¸«à¸£à¸±à¸šà¸—à¸”à¸ªà¸­à¸šà¸à¸²à¸£à¸—à¸³à¸‡à¸²à¸™à¸£à¹ˆà¸§à¸¡à¸à¸±à¸™à¸‚à¸­à¸‡à¸«à¸¥à¸²à¸¢à¸ªà¹ˆà¸§à¸™ - à¸—à¸±à¹‰à¸‡à¸„à¸¹à¹ˆà¸¡à¸µà¸„à¸§à¸²à¸¡à¸ªà¸³à¸„à¸±à¸à¹à¸¥à¸°à¹ƒà¸Šà¹‰à¹€à¸ªà¸£à¸´à¸¡à¸à¸±à¸™! ğŸ¯
